# PIP_kuaichuan（局域网网页共享）

局域网文件互传工具，以网页方式共享给同事使用（无需安装客户端）。

---

<img width="3810" height="822" alt="image" src="https://github.com/user-attachments/assets/52d1e6ed-6da7-44c4-bb48-63646851ac5f" />


---

## 一、使用流程

### 服务器端（启动服务）

1. 进入 `BASE/` 目录，安装依赖（首次）：
   ```bash
   cd BASE
   npm install
   ```
2. 启动服务：
   ```bash
   npm start
   ```
3. 控制台输出以下日志说明启动成功：
   ```
   [PIP_KuaiChuan] Web share ready: http://<本机局域网IP>:9999
   ```
4. 把这个地址发给同事即可。

### 同事使用（浏览器访问）

1. 同事在同一局域网，用浏览器打开服务器地址。
2. 左侧"昵称"首次建议改成真实姓名，便于识别上传者。
3. 可直接进行：上传、下载、新建文件夹、重命名、移动（拖拽）、删除。
4. 支持多选文件批量下载。
5. 文件夹下载自动打包为 zip。
6. 点击"查看日志"可查看操作审计日志和服务器运行日志。

---

## 二、项目结构

```
PIP_KC/
├── BASE/                        ← 源码目录（cd 到此处执行 npm start）
│   ├── web-server.js            ← 启动入口
│   ├── package.json
│   ├── src/
│   │   ├── server.js            ← Express Web 服务核心
│   │   └── config.js            ← 路径配置、设备ID生成
│   └── renderer/
│       ├── index.html           ← 前端页面
│       ├── app.js               ← 前端逻辑
│       ├── styles.css
│       └── favicon.svg
│
└── download/                    ← 数据目录（自动生成，勿手动修改）
    ├── shared_disk/             ← 共享文件存储根目录
    └── data/
        ├── config.json          ← 服务配置（设备ID、端口等）
        ├── file_meta.json       ← 文件元数据（存储类型、上传者、过期时间等）
        ├── client_profiles.json ← 访问者昵称映射（IP → 用户ID）
        └── log.txt              ← 操作审计日志
```

> **路径说明**：`download/` 目录由 `src/config.js` 通过相对路径自动定位，
> 无论项目放在哪里都能正确找到，不存在硬编码路径。

---

## 三、功能特性

| 功能 | 说明 |
|------|------|
| 网页直连 | 同事只需浏览器，无需安装任何客户端 |
| 上传进度 | 实时显示上传速度和百分比 |
| 拖拽上传 | 支持拖拽文件或整个文件夹，保留目录结构 |
| 文件夹下载 | 自动打包为 zip，两步走（打包→token→下载） |
| 批量下载 | 多选文件后统一下载 |
| 存储分级 | 上传文件默认 24h 临时，管理员可升级为永久 |
| 拖拽移动 | 拖拽条目到文件夹可移动 |
| 重命名/删除 | 支持文件和文件夹 |
| 并发上传 | 默认并发 8，按文件数量自动调整（最大 12）|
| 审计日志 | 记录所有上传/下载/重命名/移动/删除操作 |
| 服务器日志 | 前端可查看服务器运行日志（错误/警告/信息） |
| favicon | 蓝色背景白色闪电 SVG 图标 |

---

## 四、部署说明

### 环境要求

- **Node.js 18+**（建议 LTS 版本）
- **Windows**（文件夹压缩依赖 PowerShell 或 tar）
- 同网段局域网（或打通的公司内网）

### 启动步骤

```bash
cd BASE
npm install   # 首次安装依赖
npm start     # 启动服务，默认端口 9999
```

### 防火墙设置

首次运行时，Windows 可能弹出防火墙提示，选择"允许访问（专用网络）"。
若已跳过，可手动添加：`控制面板 → 防火墙 → 允许应用 → node.exe`。

---

## 五、常见问题

### 同事打不开页面

- 确认访问的是控制台输出的 IP（不是 `localhost`）。
- 确认双方在同一网段，且路由器未开启 AP 隔离。
- 检查 Windows 防火墙是否放行了 `node.exe` 入站连接。
- 测试端口是否可达：
  ```powershell
  Test-NetConnection <服务器IP> -Port 9999
  ```

### 启动报 `EADDRINUSE`（端口被占用）

说明 9999 端口已被其他进程占用，结束旧进程或修改 `download/data/config.json` 中的 `hostPort`。

### 文件夹下载失败

- 需要 Windows 系统有 PowerShell 或 `tar` 命令支持压缩。
- 如报错可查看前端"服务器运行日志"获取详细错误。

### 上传速度不理想

- 已启用动态并发上传（默认 8）。
- 建议服务器使用有线网络，避免跨弱 Wi-Fi 传输。
